<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><title>Python: module age_gender_classify</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
</head><body bgcolor="#f0f0f8">

<table width="100%" cellspacing=0 cellpadding=2 border=0 summary="heading">
<tr bgcolor="#7799ee">
<td valign=bottom>&nbsp;<br>
<font color="#ffffff" face="helvetica, arial">&nbsp;<br><big><big><strong>age_gender_classify</strong></big></big></font></td
><td align=right valign=bottom
><font color="#ffffff" face="helvetica, arial"><a href=".">index</a><br><a href="file:./age_gender_classify.py">age_gender_classify.py</a></font></td></tr></table>
    <p></p>
<p>
<table width="100%" cellspacing=0 cellpadding=2 border=0 summary="section">
<tr bgcolor="#aa55cc">
<td colspan=3 valign=bottom>&nbsp;<br>
<font color="#ffffff" face="helvetica, arial"><big><strong>Modules</strong></big></font></td></tr>
    
<tr><td bgcolor="#aa55cc"><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</tt></td><td>&nbsp;</td>
<td width="100%"><table width="100%" summary="list"><tr><td width="25%" valign=top><a href="PIL.Image.html">PIL.Image</a><br>
<a href="keras.preprocessing.image.html">keras.preprocessing.image</a><br>
</td><td width="25%" valign=top><a href="numpy.html">numpy</a><br>
<a href="time.html">time</a><br>
</td><td width="25%" valign=top><a href="transformation.utils.html">transformation.utils</a><br>
</td><td width="25%" valign=top></td></tr></table></td></tr></table><p>
<table width="100%" cellspacing=0 cellpadding=2 border=0 summary="section">
<tr bgcolor="#eeaa77">
<td colspan=3 valign=bottom>&nbsp;<br>
<font color="#ffffff" face="helvetica, arial"><big><strong>Functions</strong></big></font></td></tr>
    
<tr><td bgcolor="#eeaa77"><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</tt></td><td>&nbsp;</td>
<td width="100%"><dl><dt><a name="-classify_image"><strong>classify_image</strong></a>(image, model=None, means=[0.45008409, 0.37675238, 0.3356632], stds=[0.28836954, 0.26367465, 0.2598381])</dt><dd><tt>Classify&nbsp;an&nbsp;image&nbsp;with&nbsp;the&nbsp;age&nbsp;and&nbsp;gender&nbsp;classifier.&nbsp;Before&nbsp;calling&nbsp;this&nbsp;method,&nbsp;please&nbsp;set&nbsp;the&nbsp;model&nbsp;with<br>
<a href="#-load_classifier">load_classifier</a>()&nbsp;or&nbsp;<a href="#-set_classifier">set_classifier</a>()&nbsp;or&nbsp;you&nbsp;specifiy&nbsp;a&nbsp;model&nbsp;to&nbsp;this&nbsp;method&nbsp;by&nbsp;setting&nbsp;the&nbsp;model&nbsp;parameter.<br>
&nbsp;<br>
Parameters:<br>
image:&nbsp;An&nbsp;image&nbsp;in&nbsp;a&nbsp;typical&nbsp;numpy&nbsp;standard&nbsp;format.&nbsp;We&nbsp;tested&nbsp;it&nbsp;for&nbsp;example&nbsp;with&nbsp;images&nbsp;generated&nbsp;by:<br>
&nbsp;&nbsp;&nbsp;&nbsp;with&nbsp;Image.open(image_path)&nbsp;as&nbsp;img:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;img&nbsp;=&nbsp;np.asarray(img)<br>
&nbsp;&nbsp;&nbsp;&nbsp;The&nbsp;dimensions&nbsp;should&nbsp;be&nbsp;112x112x3&nbsp;and&nbsp;the&nbsp;face&nbsp;should&nbsp;be&nbsp;visible&nbsp;and&nbsp;if&nbsp;possible&nbsp;at&nbsp;least&nbsp;a&nbsp;little&nbsp;bit<br>
&nbsp;&nbsp;&nbsp;&nbsp;centered&nbsp;and&nbsp;big&nbsp;enough&nbsp;to&nbsp;be&nbsp;able&nbsp;to&nbsp;recognise&nbsp;something.&nbsp;So&nbsp;a&nbsp;face&nbsp;cropping&nbsp;+&nbsp;registration&nbsp;will&nbsp;improve<br>
&nbsp;&nbsp;&nbsp;&nbsp;the&nbsp;results.<br>
model:&nbsp;Optional&nbsp;if&nbsp;already&nbsp;set.&nbsp;If&nbsp;you&nbsp;want&nbsp;to&nbsp;use&nbsp;another&nbsp;model&nbsp;than&nbsp;set&nbsp;by&nbsp;<a href="#-load_classifier">load_classifier</a>()&nbsp;or<br>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#-set_classifier">set_classifier</a>()&nbsp;you&nbsp;can&nbsp;use&nbsp;this&nbsp;parameter.&nbsp;Otherwise&nbsp;please&nbsp;use&nbsp;the&nbsp;two&nbsp;mentioned&nbsp;functions&nbsp;before&nbsp;to&nbsp;set&nbsp;the<br>
&nbsp;&nbsp;&nbsp;&nbsp;model&nbsp;once.&nbsp;Not&nbsp;every&nbsp;model&nbsp;can&nbsp;be&nbsp;used&nbsp;because&nbsp;this&nbsp;method&nbsp;expects&nbsp;a&nbsp;model&nbsp;that&nbsp;outputs&nbsp;2&nbsp;seperate&nbsp;results&nbsp;for<br>
&nbsp;&nbsp;&nbsp;&nbsp;gender&nbsp;and&nbsp;age.&nbsp;If&nbsp;you&nbsp;want&nbsp;to&nbsp;use&nbsp;a&nbsp;model&nbsp;that&nbsp;does&nbsp;not&nbsp;fulfill&nbsp;this&nbsp;criteria,&nbsp;you&nbsp;can&nbsp;easily&nbsp;change&nbsp;the&nbsp;code.<br>
means:&nbsp;Optional.&nbsp;The&nbsp;mean&nbsp;which&nbsp;is&nbsp;subtracted&nbsp;from&nbsp;the&nbsp;images.&nbsp;Default&nbsp;values&nbsp;were&nbsp;computed&nbsp;from&nbsp;the<br>
&nbsp;&nbsp;&nbsp;&nbsp;IMDB-Wiki&nbsp;dataset<br>
stds:&nbsp;Optional.&nbsp;The&nbsp;standard&nbsp;deviation&nbsp;which&nbsp;is&nbsp;used&nbsp;to&nbsp;normalize&nbsp;the&nbsp;image.&nbsp;Default&nbsp;values&nbsp;were&nbsp;computed<br>
&nbsp;&nbsp;&nbsp;&nbsp;from&nbsp;the&nbsp;IMDB-Wiki&nbsp;dataset<br>
&nbsp;<br>
Returns:&nbsp;a&nbsp;list&nbsp;with&nbsp;4&nbsp;values:&nbsp;[gender_class_id,&nbsp;age_class_id,&nbsp;gender_class_confidence,&nbsp;age_class_confidence].<br>
The&nbsp;gender_class_id&nbsp;is&nbsp;0&nbsp;or&nbsp;1&nbsp;and&nbsp;represents&nbsp;an&nbsp;index&nbsp;for&nbsp;the&nbsp;following&nbsp;classes:<br>
['female',&nbsp;'male']<br>
The&nbsp;age_class_id&nbsp;is&nbsp;an&nbsp;index&nbsp;of&nbsp;the&nbsp;following&nbsp;array&nbsp;of&nbsp;age&nbsp;classes:<br>
['[0&nbsp;-&nbsp;15]',&nbsp;'[16&nbsp;-&nbsp;20]',&nbsp;'[21&nbsp;-&nbsp;25]',&nbsp;'[26&nbsp;-&nbsp;30]',&nbsp;'[31&nbsp;-&nbsp;35]',<br>
&nbsp;'[36&nbsp;-&nbsp;40]',&nbsp;'[41&nbsp;-&nbsp;45]',&nbsp;'[46&nbsp;-&nbsp;50]',&nbsp;'[51&nbsp;-&nbsp;55]',&nbsp;'[56&nbsp;-&nbsp;100]']<br>
&nbsp;<br>
&nbsp;<br>
General&nbsp;Description&nbsp;/&nbsp;How-To:<br>
[0.&nbsp;Install&nbsp;needed&nbsp;libraries&nbsp;if&nbsp;necessary.&nbsp;Numpy,&nbsp;Keras,&nbsp;Theano/Tensorflow&nbsp;(we&nbsp;used&nbsp;Theano),...]<br>
1.&nbsp;Load&nbsp;this&nbsp;source&nbsp;file&nbsp;by&nbsp;using&nbsp;something&nbsp;like:<br>
&nbsp;&nbsp;&nbsp;&nbsp;'import&nbsp;age_gender_classify',&nbsp;or&nbsp;'from&nbsp;age_gender_classify&nbsp;import&nbsp;classify_image,&nbsp;load_classifier'<br>
2.&nbsp;Load&nbsp;the&nbsp;classifier&nbsp;with&nbsp;<a href="#-load_classifier">load_classifier</a>()&nbsp;or&nbsp;if&nbsp;you&nbsp;already&nbsp;loaded&nbsp;it&nbsp;somewhere&nbsp;else&nbsp;(probably&nbsp;not)&nbsp;you&nbsp;can&nbsp;use<br>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#-set_classifier">set_classifier</a>().&nbsp;Do&nbsp;this&nbsp;only&nbsp;once&nbsp;at&nbsp;the&nbsp;beginning&nbsp;(ex.&nbsp;server&nbsp;startup)&nbsp;as&nbsp;it&nbsp;is&nbsp;costly.<br>
3.&nbsp;As&nbsp;soon&nbsp;as&nbsp;you&nbsp;get&nbsp;an&nbsp;image&nbsp;(if&nbsp;it&nbsp;has&nbsp;to&nbsp;be&nbsp;loaded,&nbsp;you&nbsp;can&nbsp;do&nbsp;this&nbsp;by&nbsp;calling&nbsp;<a href="#-load_image">load_image</a>()&nbsp;but&nbsp;you&nbsp;will<br>
&nbsp;&nbsp;&nbsp;&nbsp;probably&nbsp;have&nbsp;it&nbsp;already&nbsp;in&nbsp;some&nbsp;format,&nbsp;if&nbsp;received&nbsp;by&nbsp;a&nbsp;server)&nbsp;you&nbsp;can&nbsp;classify&nbsp;it&nbsp;with&nbsp;<a href="#-classify_image">classify_image</a>().<br>
&nbsp;<br>
If&nbsp;these&nbsp;instructions&nbsp;are&nbsp;not&nbsp;clear&nbsp;enough,&nbsp;look&nbsp;at&nbsp;the&nbsp;method&nbsp;<a href="#-demo_classification">demo_classification</a>()&nbsp;where&nbsp;a&nbsp;complete<br>
classification&nbsp;is&nbsp;performed&nbsp;(except&nbsp;for&nbsp;the&nbsp;imports&nbsp;as&nbsp;it&nbsp;is&nbsp;in&nbsp;the&nbsp;same&nbsp;file).</tt></dd></dl>
 <dl><dt><a name="-demo_classification"><strong>demo_classification</strong></a>()</dt><dd><tt>Performs&nbsp;a&nbsp;demo&nbsp;classification.&nbsp;Look&nbsp;into&nbsp;the&nbsp;code&nbsp;if&nbsp;you&nbsp;need&nbsp;help&nbsp;with&nbsp;using&nbsp;the&nbsp;above&nbsp;functions.<br>
Example&nbsp;output&nbsp;on&nbsp;a&nbsp;relatively&nbsp;slow&nbsp;machine&nbsp;with&nbsp;no&nbsp;GPU&nbsp;support:<br>
Starting&nbsp;Demo&nbsp;Classification...<br>
Loading&nbsp;of&nbsp;the&nbsp;model&nbsp;took&nbsp;12.141696214675903&nbsp;seconds<br>
The&nbsp;person&nbsp;on&nbsp;the&nbsp;image&nbsp;is&nbsp;male&nbsp;and&nbsp;[21&nbsp;-&nbsp;25]&nbsp;years&nbsp;old<br>
Classification&nbsp;took&nbsp;0.45056692361831663&nbsp;seconds&nbsp;per&nbsp;image</tt></dd></dl>
 <dl><dt><a name="-load_classifier"><strong>load_classifier</strong></a>(model_path='ageGenderModel.h5')</dt><dd><tt>Load&nbsp;the&nbsp;classifier&nbsp;specified&nbsp;by&nbsp;the&nbsp;path.&nbsp;This&nbsp;has&nbsp;to&nbsp;be&nbsp;done&nbsp;once&nbsp;before&nbsp;images&nbsp;can&nbsp;be&nbsp;classified&nbsp;and&nbsp;should<br>
not&nbsp;be&nbsp;done&nbsp;more&nbsp;than&nbsp;once&nbsp;because&nbsp;it&nbsp;can&nbsp;take&nbsp;a&nbsp;few&nbsp;seconds.<br>
&nbsp;<br>
Parameters:<br>
&nbsp;&nbsp;&nbsp;&nbsp;model_path:&nbsp;the&nbsp;path&nbsp;to&nbsp;the&nbsp;h5&nbsp;model&nbsp;file.&nbsp;Default&nbsp;is&nbsp;the&nbsp;ageGenderModel.h5&nbsp;file&nbsp;that&nbsp;should&nbsp;be&nbsp;on&nbsp;the<br>
&nbsp;&nbsp;&nbsp;&nbsp;same&nbsp;folder&nbsp;level&nbsp;than&nbsp;the&nbsp;script<br>
&nbsp;<br>
Returns:&nbsp;the&nbsp;model.&nbsp;But&nbsp;it&nbsp;is&nbsp;unnecessary&nbsp;to&nbsp;use&nbsp;the&nbsp;returned&nbsp;model&nbsp;object&nbsp;because&nbsp;the&nbsp;model&nbsp;is&nbsp;also&nbsp;saved&nbsp;in<br>
a&nbsp;variable&nbsp;which&nbsp;is&nbsp;then&nbsp;used&nbsp;by&nbsp;the&nbsp;<a href="#-classify_image">classify_image</a>()&nbsp;method.&nbsp;But&nbsp;if&nbsp;you&nbsp;want&nbsp;to&nbsp;use&nbsp;several&nbsp;different&nbsp;model&nbsp;files<br>
you&nbsp;can&nbsp;use&nbsp;the&nbsp;returned&nbsp;model&nbsp;and&nbsp;pass&nbsp;it&nbsp;as&nbsp;an&nbsp;optional&nbsp;parameter&nbsp;to&nbsp;<a href="#-classify_image">classify_image</a>()</tt></dd></dl>
 <dl><dt><a name="-load_image"><strong>load_image</strong></a>(image_path)</dt><dd><tt>Loads&nbsp;an&nbsp;image&nbsp;specified&nbsp;by&nbsp;the&nbsp;path&nbsp;from&nbsp;the&nbsp;disc.</tt></dd></dl>
 <dl><dt><a name="-preprocess_image"><strong>preprocess_image</strong></a>(sample, means=None, stds=None, dims=None, out_shape=None)</dt><dd><tt>Internally&nbsp;used&nbsp;method&nbsp;for&nbsp;preprocessing&nbsp;an&nbsp;image&nbsp;which&nbsp;should&nbsp;be&nbsp;classified.<br>
The&nbsp;image&nbsp;is:&nbsp;resized,&nbsp;casted&nbsp;to&nbsp;float,&nbsp;the&nbsp;mean&nbsp;is&nbsp;subtracted,&nbsp;it&nbsp;is&nbsp;divided&nbsp;by&nbsp;the&nbsp;std&nbsp;and&nbsp;the<br>
dimensions&nbsp;are&nbsp;changed&nbsp;to&nbsp;be&nbsp;supported&nbsp;by&nbsp;Keras&nbsp;(112x112x3&nbsp;--&gt;&nbsp;3x112x112)<br>
&nbsp;<br>
Parameters:<br>
&nbsp;&nbsp;&nbsp;&nbsp;sample:&nbsp;the&nbsp;image&nbsp;to&nbsp;preprocess<br>
&nbsp;&nbsp;&nbsp;&nbsp;means:&nbsp;the&nbsp;means&nbsp;to&nbsp;subtract&nbsp;from&nbsp;the&nbsp;image<br>
&nbsp;&nbsp;&nbsp;&nbsp;stds:&nbsp;the&nbsp;standard&nbsp;deviation&nbsp;which&nbsp;is&nbsp;used&nbsp;to&nbsp;normalize&nbsp;the&nbsp;image<br>
&nbsp;&nbsp;&nbsp;&nbsp;dims:&nbsp;the&nbsp;image&nbsp;dimensions&nbsp;(should&nbsp;be&nbsp;112x112x3)<br>
&nbsp;&nbsp;&nbsp;&nbsp;out_shape:&nbsp;the&nbsp;image&nbsp;dimensions&nbsp;after&nbsp;reshaping&nbsp;(should&nbsp;be&nbsp;3x112x112)<br>
&nbsp;<br>
Returns:&nbsp;the&nbsp;preprocessed&nbsp;image</tt></dd></dl>
 <dl><dt><a name="-set_classifier"><strong>set_classifier</strong></a>(model)</dt><dd><tt>Set&nbsp;the&nbsp;standard&nbsp;model&nbsp;manually.&nbsp;Will&nbsp;probably&nbsp;not&nbsp;be&nbsp;necessary&nbsp;as&nbsp;it&nbsp;is&nbsp;set&nbsp;automatically&nbsp;by&nbsp;load_classifier<br>
&nbsp;<br>
Parameters:<br>
&nbsp;&nbsp;&nbsp;&nbsp;model:&nbsp;the&nbsp;new&nbsp;standard&nbsp;model<br>
&nbsp;<br>
Returns:&nbsp;nothing</tt></dd></dl>
</td></tr></table><p>
<table width="100%" cellspacing=0 cellpadding=2 border=0 summary="section">
<tr bgcolor="#55aa55">
<td colspan=3 valign=bottom>&nbsp;<br>
<font color="#ffffff" face="helvetica, arial"><big><strong>Data</strong></big></font></td></tr>
    
<tr><td bgcolor="#55aa55"><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</tt></td><td>&nbsp;</td>
<td width="100%"><strong>ageAndGenderModel</strong> = None</td></tr></table>
</body></html>
